{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",

  "width": 750,
  "height": 600,

  "data": {
    "url": "../data/visualization2/data.csv"
  },

  "encoding": {
    "y": {"field": "Touchpoint A", "type": "ordinal", "sort": ["Rx", "Rx + OD", "OD", "∅"], "title": null, "axis": {"labelFontSize": 15}},
    "x": {"field": "Touchpoint B", "type": "ordinal", "sort": ["∅", "Jail", "Jail + Health", "Health"], "title": null, "axis": {"labelAngle": 0, "labelFontSize": 15}}
  },

  "layer": [
    {
      "selection": {"highlight": {"type": "single"}},
      "mark": {
        "type": "circle", 
        "strokeWidth": 1,
        "stroke": "black",
        "opacity": 1
      },
      "encoding": {
        "tooltip": [
          {
            "field": "Touchpoint A",
            "title": "Touchpoint A",
            "type": "ordinal"
          },
          {
            "field": "Touchpoint B",
            "title": "Touchpoint B",
            "type": "ordinal"
          },
          {
            "field": "Deaths",
            "title": "Deaths",
            "type": "ordinal"
          }
        ],
        "size": {
          "condition": {"test": "datum['Deaths'] == 0", "value": 0},
          "field": "Deaths", 
          "type": "quantitative",
          "scale": {"range": [200, 6000]}, 
          "legend": {
            "values": [20, 100, 200, 400, 800],
            "symbolStrokeColor": "black",
            "symbolStrokeWidth": 1,
            "labelAlign": "center",
            "labelOffset": -38
          }
        },
        "color": {
          "field": "Deaths",
          "type": "quantitative",
          "scale": {
            "type": "sqrt", 
            "scheme": "lightmulti"
          }
        }
      }
    },
    {
      "mark": {"type": "text", "dy": -60},
      "encoding": {
        "text": {"field": "Set", "type": "nominal"}
      }
    },
    {
      "mark": {"type": "text"},
      "encoding": {
        "text": {"field": "Deaths", "type": "quantitative"}
      }
    },
    {
      "mark": {
        "type": "text",
        "fontSize": 0
      },
      "encoding": {
        "text": {"field": " ", "type": "ordinal"},
        "fill": {
          "field": " ",
          "type": "ordinal",
          "legend": {
            "values": ["Rx: Opioid Prescription", "OD: Overdose", "Jail: Incarceration", "Health: Health Data", "∅: No Touchpoints"],
            "symbolOffset": -15
          }
        }
      }
    }
  ],

  "config": {
    "scale": {
      "bandPaddingInner": 0,
      "bandPaddingOuter": 0
    },
    "view": {"step": 40},
    "axis": {
      "domain": false
    }
  }
}