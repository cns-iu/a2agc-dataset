{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "padding": 0,
  "config": {
    "view": {"strokeOpacity": 0}
  },

  "data": {
    "url": "../data/visualization2/data.csv",
    "format": {
      "type": "csv",
      "parse": {
        "PERIOD": "date"
      }
    }
  },

  "vconcat": [
    {
      "width": 703,
      "height": 500,
      "transform": [
        {"filter": { "selection": "period" }}
      ],
      "encoding": {
        "y": {"field": "Touchpoint A", "type": "ordinal", "sort": ["Rx", "Rx + OD", "OD", "∅"], "title": null, "axis": null},
        "x": {"field": "Touchpoint B", "type": "ordinal", "sort": ["∅", "Jail", "Jail + Health", "Health"], "title": null, "axis": null}
      },
      "layer": [
        {
          "selection": {"click": {"encodings": ["size"], "type": "multi"}},
          "mark": {
            "type": "circle", 
            "strokeWidth": 1,
            "stroke": "black",
            "opacity": 1
          },
          "encoding": {
            "tooltip": [
              {
                "field": "Touchpoint A",
                "title": "Touchpoint A",
                "type": "ordinal"
              },
              {
                "field": "Touchpoint B",
                "title": "Touchpoint B",
                "type": "ordinal"
              },
              {
                "aggregate": "sum",
                "field": "True",
                "title": "Deaths",
                "type": "quantitative"
              }
            ],
            "size": {
              "aggregate": "sum",
              "field": "True",
              "type": "quantitative",
              "scale": {"range": [0, 6000]},
              "legend": null
            },
            "color": {
              "aggregate": "sum",
              "field": "True",
              "type": "quantitative",
              "scale": {
                "type": "sqrt", 
                "scheme": "blues"
              }
            }
          }
        },
        {
          "mark": {"type": "text", "dy": -60},
          "encoding": {
            "text": {"aggregate": "max", "field": "Set", "type": "nominal"}
          }
        },
        {
          "mark": {"type": "text", "dy": -45, "fontStyle": "bold"},
          "encoding": {
            "text": {"aggregate": "sum", "field": "True", "type": "quantitative"}
          }
        },



        {
          "mark": {
            "type": "text",
            "fontSize": 0
          },
          "encoding": {
            "fill": {
              "field": " ",
              "title": null,
              "type": "ordinal",
              "legend": {
                "values": ["Rx: Opioid Prescription", "OD: Overdose", "Jail: Incarceration", "Health: Health Data", "∅: No Touchpoints"],
                "symbolOffset": -15
              }
            }
          }
        }
      ]
    },

    {
      "width": 703,
      "height": 150,
      "view": {
        "strokeOpacity": 0
      },
      "layer": [
        {
          "mark": {
            "type": "line"
          },
          "transform": [{"filter": {"selection": "click"}}],
          "selection": {
            "period": {
              "type": "interval",
              "encodings": ["x"],
              "on": "[mousedown, window:mouseup] > window:mousemove{150, 300}"
            }
          },
          "encoding": {
            "x": {
              "field": "PERIOD",
              "type": "temporal",
              "title": "Date of Death",
              "axis": {
                "labelFlush": false,
                "labelExpr": "[timeFormat(datum.value, '%m') == '01' ? timeFormat(datum.value, '%Y') : '']",
                "gridDash": {
                  "condition": {"test": {"field": "value", "timeUnit": "month", "equal": 7}, "value": [2,2]},
                  "value": []
                }
              }
            },
            "y": {
              "aggregate": "sum",
              "field": "True",
              "type": "quantitative",
              "title": "# Deaths by Quarter",
              "axis": {
                "gridOpacity": {
                  "condition": {"test": {"field": "index", "equal": 1}, "value": 0},
                  "value": 1
                },
                "tickOpacity": {
                  "condition": {"test": {"field": "index", "equal": 1}, "value": 0},
                  "value": 1
                },
                "labelFontSize": {
                  "condition": {"test": {"field": "index", "equal": 1}, "value": 0},
                  "value": 10
                }
              }
            },
            "color": {
              "value": "blue"
            }
          }
        }
      ]
    }
  ]
}

