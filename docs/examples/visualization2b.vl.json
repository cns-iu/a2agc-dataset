{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "padding": 0,
  "config": {
    "view": {"strokeOpacity": 0}
  },

  "data": {
    "url": "../data/visualization2/data.csv",
    "format": {
      "type": "csv",
      "parse": {
        "PERIOD": "date"
      }
    }
  },

  "vconcat": [
    {
      "width": 903,
      "height": 600,
      "transform": [
        {"filter": { "selection": "period" }}
      ],
      "encoding": {
        "y": {
          "field": "Touchpoint A", 
          "type": "quantitative", 
          "title": null, 
          "scale": {
            "domain": [-0.5,3.5]
          },
          "axis": {
            "grid": false,
            "domain": false,
            "labels": false,
            "ticks": false
          }
        },
        "x": {
          "field": "Touchpoint B",
          "type": "quantitative", 
          "title": null,
          "scale": {
            "domain": [-0.5,3.5]
          },
          "axis": {
            "grid": false,
            "domain": false,
            "labels": false,
            "ticks": false
          }
        }
      },
      "layer": [
        {
          "transform": [
            {
              "aggregate": [{"op": "sum", "field": "True", "as": "cat"}], "groupby": ["Touchpoint A", "Touchpoint B"]
            }
          ],
          "selection": {"click": {"encodings": ["size"], "type": "multi"}},
          "mark": {"type": "circle", "yOffset": 10},
          "encoding": {
            "tooltip": [
              {
                "field": "Touchpoint A",
                "title": "Touchpoint A",
                "type": "ordinal"
              },
              {
                "field": "Touchpoint B",
                "title": "Touchpoint B",
                "type": "ordinal"
              },
              {
                "aggregate": "sum",
                "field": "True",
                "title": "Deaths",
                "type": "quantitative"
              }
            ],
            "size": {
              "field": "cat",
              "type": "quantitative",
              "scale": {"range": [0, 6000]},
              "legend": null
            },
            "color": {
              "field": "cat",
              "type": "quantitative",
              "scale": {
                "type": "sqrt", 
                "scheme": "blues"
              }
            }
          }
        },

        {
          "mark": {"type": "text", "dy": -65, "fontSize": 16},
          "encoding": {
            "text": {"aggregate": "max", "field": "Set", "type": "nominal"}
          }
        },

        {
          "mark": {
            "type": "text",
            "fontSize": 0
          },

          "encoding": {
            "fill": {
              "field": " ",
              "title": "Legend",
              "type": "ordinal",
              "legend": {
                "orient": "left",
                "values": ["Rx = Opioid Prescription", "OD = Overdose", "Jail = Incarceration", "Health = Health Data", "âˆ… = No Touchpoints"],
                "symbolOffset": -15,
                "titlePadding": 10,
                "titleColor": "#9e9e9e"
              }
            }
          }
        },

        {
          "mark": {"type": "text", "fontSize": 0},
          "encoding": {
            "color": {
              "title": "# Deaths",
              "aggregate": "sum",
              "field": "True",
              "type": "quantitative",
              "legend": {
                "orient": "none",
                "legendX": -170,
                "legendY": 110,
                "titleAlign": "center",
                "titlePadding": 10,
                "gradientLength": 150,
                "labelFontSize": 8,
                "labelOffset": 8
              }
            }
          }
        },

        {
          "mark": {"type": "text", "dy": -45, "fontStyle": "bold", "fontSize": 16},
          "encoding": {
            "text": {"aggregate": "sum", "field": "True", "type": "quantitative"}
          }
        }
      ]
    },

    {
      "title": {
        "text": "Select Date Range to Update Datasets",
        "align": "right",
        "dx": -200,
        "dy": -20,
        "fontSize": 16
      },
      "width": 903,
      "height": 150,
      "view": {
        "strokeOpacity": 0
      },
      "layer": [
        {
          "mark": {
            "type": "line"
          },
          "transform": [{"filter": {"selection": "click"}}],
          "selection": {
            "period": {
              "type": "interval", 
              "encodings": ["x"],
              "on": "[mousedown, window:mouseup] > window:mousemove{150, 300}",
              "mark": {"fill": "#6ea7ef", "fillOpacity": 0.15}
            }
          },
          "encoding": {
            "x": {
              "field": "PERIOD",
              "type": "temporal",
              "title": "Year",
              "axis": {
                "minExtent": 30,
                "titleFontSize": 14,
                "tickColor": "#757575",
                "domainColor": "#757575",
                "labelFlush": false,
                "labelExpr": "[timeFormat(datum.value, '%m') == '01' ? timeFormat(datum.value, '%Y') : '']",
                "gridDash": {
                  "condition": {"test": {"field": "value", "timeUnit": "month", "equal": 7}, "value": [2,2]},
                  "value": []
                },
                "gridColor": {
                  "condition": {"test": {"field": "value", "timeUnit": "month", "equal": 1}, "value": "#BDBDBD"},
                  "value": "#e0e0e0"
                }
              }
            },
            "y": {
              "aggregate": "sum",
              "field": "True",
              "type": "quantitative",
              "title": "# Deaths",
              "axis": {
                "titleFontSize": 14,
                "gridColor": "#e0e0e0",
                "tickColor": "#757575",
                "domainColor": "#757575",
                "gridOpacity": {
                  "condition": {"test": {"field": "index", "equal": 1}, "value": 0},
                  "value": 1
                },
                "tickOpacity": {
                  "condition": {"test": {"field": "index", "equal": 1}, "value": 0},
                  "value": 1
                },
                "labelFontSize": {
                  "condition": {"test": {"field": "index", "equal": 1}, "value": 0},
                  "value": 10
                }
              }
            },
            "color": {
              "value": "#6ea7ef"
            }
          }
        }
      ]
    }
  ]
}
