{
	"$schema": "https://vega.github.io/schema/vega-lite/v4.json",
	"config": {
		"mark": {
			"tooltip": null
		},
	    "view": {
      		"stroke": "transparent"
    	}
	},
	"data": {
		"url": "../data/visualization4/data.csv"
	},
	"vconcat": [
		{
			"hconcat": [
				{
					"encoding": {
						"color": {
							"legend": null,
							"field": "TOTAL_DEATHS",
							"scale": {
								"scheme": "yellowgreenblue"
							},
							"title": "Deaths",
							"type": "quantitative"
						},
						"tooltip": [
							{
								"field": "TOTAL_DEATHS",
								"title": "Deaths",
								"type": "ordinal"
							},
							{
								"field": "group",
								"title": "Age Group",
								"type": "ordinal"
							},
							{
								"field": "YEAR",
								"title": "YEAR",
								"type": "ordinal"
							}
						],
						"x": {
							"field": "YEAR",
							"title": "Year",
							"type": "ordinal",
							"axis": { 
								"labelAngle": 0
							}
						},
						"y": {
							"axis": {
								"labels": true
							},
							"field": "group",
							"title": "Age Group",
							"type": "ordinal",
							"scale": { "reverse": true }
						}
					},
					"mark": "rect",
					"title": "All Substances",
					"transform": [
						{
							"filter": {
								"selection": "pts"
							}
						},
						{
							"filter": {
								"selection": "year_selection"
							}
						},
						{
							"aggregate": [
								{
									"as": "TOTAL_DEATHS",
									"field": "CASE_NUMBER",
									"op": "distinct"
								}
							],
							"groupby": [
								"AGE_GROUP",
								"YEAR"
							]
						},
						{
							"as": "group",
							"calculate": "toString(10 * datum.AGE_GROUP) + \"-\" + toString(10 * datum.AGE_GROUP + 9)"
						}
					],
					"width": 500,
					"height": 400
				},
				{
					"title": "All Substances",
					"mark": "bar",
					"encoding": {
						"x": {
							"aggregate": "distinct",
							"field": "CASE_NUMBER",
							"type": "quantitative",
							"title": "Deaths"
						},
						"y": {
							"axis": {
								"labels": true
							},
							"field": "group",
							"title": "Age Group",
							"type": "ordinal",
							"scale": { "reverse": true }
						},
						"tooltip": [
							{
								"aggregate": "distinct",
								"field": "CASE_NUMBER",
								"type": "quantitative",
								"title": "Total"
							},
							{
								"field": "group",
								"title": "Age Group",
								"type": "ordinal"
							}
						]
					},
					"transform": [
						{
							"filter": {
								"selection": "pts"
							}
						},
						{
							"filter": {
								"selection": "year_selection"
							}
						},
						{
							"as": "group",
							"calculate": "toString(10 * datum.AGE_GROUP) + \"-\" + toString(10 * datum.AGE_GROUP + 9)"
						}
					],
					"width": 500,
					"height": 400
				}
			]
		},
		{
			"hconcat": [
				{
					"mark": "line",
					"width": 870,
					"height": 200,
					"title": "Update Graphs Using Filters Below",
					"encoding": {
						"x": {
							"field": "YEAR",
							"type": "ordinal",
							"axis": {
								"title": "Year",
								"labelAngle": 0
							}
						},
						"y": {
							"field": "TOTAL_DEATHS",
							"type": "quantitative",
							"axis": {
								"title": "# Deaths"
							}
						}
					},
					"selection": {
						"year_selection": {
							"type": "interval",
							"encodings": [
								"x"
							]
						}
					},
					"transform": [
						{
							"filter": {
								"selection": "pts"
							}
						},
						{
							"aggregate": [
								{
									"as": "TOTAL_DEATHS",
									"field": "CASE_NUMBER",
									"op": "distinct"
								}
							],
							"groupby": [
								"YEAR"
							]
						}
					]
				},
				{
					"data": {
						"values": [
							{
								"SUBSTANCE_NAME": "Heroin",
								"SEX": "M"
							},
							{
								"SUBSTANCE_NAME": "Heroin",
								"SEX": "F"
							},
							{
								"SUBSTANCE_NAME": "Methamphetamine",
								"SEX": "M"
							},
							{
								"SUBSTANCE_NAME": "Methamphetamine",
								"SEX": "F"
							},
							{
								"SUBSTANCE_NAME": "Fentanyl",
								"SEX": "M"
							},
							{
								"SUBSTANCE_NAME": "Fentanyl",
								"SEX": "F"
							},
							{
								"SUBSTANCE_NAME": "Any Opioid",
								"SEX": "M"
							},
							{
								"SUBSTANCE_NAME": "Any Opioid",
								"SEX": "F"
							},
							{
								"SUBSTANCE_NAME": "Benzodiazepine",
								"SEX": "M"
							},
							{
								"SUBSTANCE_NAME": "Benzodiazepine",
								"SEX": "F"
							},
							{
								"SUBSTANCE_NAME": "Cocaine",
								"SEX": "M"
							},
							{
								"SUBSTANCE_NAME": "Cocaine",
								"SEX": "F"
							},
							{
								"SUBSTANCE_NAME": "Prescription Opioid",
								"SEX": "M"
							},
							{
								"SUBSTANCE_NAME": "Prescription Opioid",
								"SEX": "F"
							}
						]
					},
					"mark": "rect",
					"height": 200,
					"width": 70,
					"selection": {
						"pts": {
							"type": "multi",
							"fields": [
								"SUBSTANCE_NAME",
								"SEX"
							]
						}
					},
					"encoding": {
						"x": {
							"field": "SEX",
							"title": "Sex",
							"type": "ordinal"
						},
						"y": {
							"field": "SUBSTANCE_NAME",
							"title": "Substance Name",
							"type": "ordinal"
						},
						"color": {
							"condition": {
								"legend": null,
								"selection": "pts",
								"aggregate": "count",
								"type": "quantitative"
							},
							"value": "grey"
						}
					}
				}
			]
		}
	]
}