{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "name": "Accidental drug overdose deaths in Marion County by place of injury 2010-2018",
  "title": {
    "text": "Accidental drug overdose deaths in Marion County by place of injury 2010-2018",
    "anchor": "middle",
    "fontSize": 24
  },
  "config": {
    "view": {
      "stroke": "transparent"
    }
  },
  "padding": {
    "left": 65,
    "right": 10,
    "bottom": 10,
    "top": 10
  },
  "autosize": {
    "type": "pad",
    "resize": true
  },
  "data": {
    "url": "../data/vis-geomap-opioid-deaths.csv",
    "format": {
      "type": "csv",
      "parse": {
        "N_OPIOID_PRESCRIPTIONS": "number",
        "LATITUDE": "number",
        "LONGITUDE": "number",
        "PERIOD": "date",
        "VALUE": "number"
      }
    }
  },
  "transform": [
    {
      "lookup": "DATA_VARIABLE",
      "from": {
        "key": "DATA_VARIABLE",
        "fields": [
          "LEGEND_ORDER",
          "LABEL",
          "LEGEND_COLOR"
        ],
        "data": {
          "url": "../data/vis5-data-variables.csv"
        }
      }
    }
  ],
  "vconcat": [
    {  
      "layer": [
        {
          "width": 550,
          "height": 600,
          "data": {
            "name": "counties",
            "url": "../data/indiana.topojson",
            "format": {
              "type": "topojson",
              "feature": "counties"
            }
          },
          "transform": [],
          "projection": {
            "type": "mercator"
          },
          "mark": {
            "type": "geoshape",
            "fill": "white",
            "stroke": "lightgray"
          }
        },
        {
          "width": 550,
          "height": 600,
          "transform": [
            {"filter": { "selection": "data_variable" }},
            {"filter": { "selection": "period" }}
          ],
          "projection": {
            "type": "mercator"
          },
          "mark": {
            "type": "point",
            "filled": true
          },
          "encoding": {
            "longitude": {
              "type": "quantitative",
              "field": "LONGITUDE"
            },
            "latitude": {
              "type": "quantitative",
              "field": "LATITUDE"
            },
            "shape": {
              "type": "nominal",
              "field": "HOME_STATE$$shape",
              "scale": null
            },
            "color": {
              "type": "nominal",
              "field": "COLOR",
              "scale": null
            },
            "size": {
              "value": 100
            }
          }
        }
      ]
    },
    {
      "width": 703,
      "height": 150,
      "view": {
        "strokeOpacity": 1
      },
      "layer": [
        {
          "transform": [],
          "mark": {
            "type": "line"
          },
          "selection": {
            "period": {
              "type": "interval",
              "encodings": [
                "x"
              ],
              "on": "[mousedown, window:mouseup] > window:mousemove{150, 300}"
            },
            "data_variable": {
              "type": "single",
              "fields": [ "DATA_VARIABLE" ],
              "bind": {"input": "select", "options": ["SEX", "AGE","OPIOID_PRESCRIPTIONS_1YEAR"]},
              "init": {"DATA_VARIABLE": "SEX"}
            }
          },
          "encoding": {
            "x": {
              "type": "temporal",
              "field": "PERIOD",
              "title": "Period"
            },
            "y": {
              "aggregate": "count",
              "type": "quantitative",
              "field": "N_OPIOID_PRESCRIPTIONS",
              "title": "Record Count"
            }
          }
        }
      ]
    }
  ]
}