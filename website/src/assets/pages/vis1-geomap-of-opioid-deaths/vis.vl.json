{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "name": "Accidental drug overdose deaths in Marion County by place of injury 2010-2018",
  "title": {
    "text": "Accidental drug overdose deaths in Marion County by place of injury 2010-2018",
    "anchor": "middle",
    "fontSize": 24
  },
  "background": "#fafafa",
  "config": {"view": {"stroke": "transparent"}},
  "padding": {"left": 65, "right": 10, "bottom": 10, "top": 10},
  "autosize": {"type": "pad", "resize": true},
  "data": {
    "url": "assets/generated/vis-geomap-opioid-deaths.csv",
    "format": {
      "type": "csv",
      "parse": {
        "N_OPIOID_PRESCRIPTIONS": "number",
        "LATITUDE": "number",
        "LONGITUDE": "number",
        "PERIOD": "date"
      }
    }
  },
  "transform": [
    {
      "lookup": "DATA_VARIABLE",
      "from": {
        "key": "DATA_VARIABLE",
        "fields": ["LEGEND_ORDER", "LABEL"],
        "data": {"url": "assets/pages/vis1-geomap-of-opioid-deaths/vis-data-variables.csv"}
      }
    },
    {
      "calculate": "datum.SEX === 'M' ? 'Male' : 'Female'",
      "as": "SEX_LABEL"
    },
    {
      "calculate": "datum.HOME_STATE$$shape === 'circle' ? 'Indiana' : 'Other'",
      "as": "HOME_STATE_LABEL"
    },
    {
      "calculate": "datum.N_OPIOID_PRESCRIPTIONS > 0 ? 'True' : 'False'",
      "as": "ANY_PRESCRIPTIONS_LABEL"
    }
  ],
  "hconcat": [
    {
      "spacing": 0,
      "vconcat": [
          {
            "mark": {"type": "text", "fontSize": 0},
            "selection": {
              "data_variable_selection": {
                "type": "single",
                "fields": ["LABEL"],
                "bind": "legend",
                "init": {"LABEL": "Age"}
              }
            },
            "encoding": {
              "fill": {
                "field": "LABEL",
                "title": "Data Variable",
                "type": "ordinal",
                "legend": {
                  "orient": "top-left",
                  "titlePadding": 10,
                  "titleColor": "black",
                  "values": [
                    "Gender",
                    "Age",
                    "Opioid Prescriptions within last year before death",
                    "Any Opioid Prescriptions before death",
                    "Prescription vs. Illicit Drugs"
                  ],
                  "symbolSize": 0,
                  "offset": -100
                }
              },
              "opacity": {
                "condition": {"selection": "data_variable_selection", "value": 1},
                "value": 0.75
              }
            }
          },
          {
            "mark": {"type": "text", "fontSize": 0},
            "selection": {
              "sex_selection": {
                "type": "single",
                "fields": ["SEX_LABEL"],
                "bind": "legend"
              }
            },
            "encoding": {
              "fill": {
                "field": "SEX_LABEL",
                "title": "Sex Filter",
                "type": "ordinal",
                "legend": {
                  "orient": "left",
                  "titlePadding": 10,
                  "titleColor": "black",
                  "values": [
                    "Male",
                    "Female"
                  ],
                  "symbolSize": 0,
                  "offset": 50
                }
              },
              "opacity": {
                "condition": {"selection": "sex_selection", "value": 1},
                "value": 0.75
              }
            }
          },
          {
            "mark": {"type": "text", "fontSize": 0},
            "encoding": {
              "fill": {
                "type": "ordinal",
                "legend": {
                  "orient": "left",
                  "titlePadding": 0,
                  "titleColor": "black",
                  "symbolSize": 0,
                  "offset": -100
                }
              }
            }
          },
          {
            "mark": {"type": "text", "fontSize": 0},
            "selection": {
              "drug_type_seleciton": {
                "type": "single",
                "fields": ["ILLICIT_V_PRESCRIPTION"],
                "bind": "legend"
              }
            },
            "encoding": {
              "fill": {
                "field": "ILLICIT_V_PRESCRIPTION",
                "title": "Drug Type Filter",
                "type": "ordinal",
                "legend": {
                  "orient": "left",
                  "titlePadding": 10,
                  "titleColor": "black",
                  "values": [
                    "Illicit",
                    "Prescription",
                    "Neither"
                  ],
                  "symbolSize": 0,
                  "offset": 15
                }
              },
              "opacity": {
                "condition": {"selection": "sex_selection", "value": 1},
                "value": 0.75
              }
            }
          },
          {
            "mark": {"type": "text", "fontSize": 0},
            "selection": {
              "home_state_selection": {
                "type": "single",
                "fields": ["HOME_STATE_LABEL"],
                "bind": "legend"
              }
            },
            "encoding": {
              "fill": {
                "field": "HOME_STATE_LABEL",
                "title": "Home State Filter",
                "type": "ordinal",
                "legend": {
                  "orient": "top-left",
                  "titlePadding": 10,
                  "titleColor": "black",
                  "values": [
                    "Indiana",
                    "Other"
                  ],
                  "symbolSize": 0,
                  "offset": -100
                }
              },
              "opacity": {
                "condition": {"selection": "home_state_selection", "value": 1},
                "value": 0.75
              }
            }
          },
          {
            "mark": {"type": "text", "fontSize": 0},
            "selection": {
              "1_year_seleciton": {
                "type": "single",
                "fields": ["OPIOID_PRESCRIPTIONS_1YEAR"],
                "bind": "legend"
              }
            },
            "encoding": {
              "fill": {
                "field": "OPIOID_PRESCRIPTIONS_1YEAR",
                "title": "Opioid Prescription 1 Year Filter",
                "type": "ordinal",
                "legend": {
                  "orient": "left",
                  "titlePadding": 10,
                  "titleColor": "black",
                  "values": [
                    "True",
                    "False"
                  ],
                  "symbolSize": 0,
                  "offset": -70
                }
              },
              "opacity": {
                "condition": {"selection": "1_year_seleciton", "value": 1},
                "value": 0.75
              }
            }
          },
          {
            "mark": {"type": "text", "fontSize": 0},
            "selection": {
              "home_state_selection": {
                "type": "single",
                "fields": ["ANY_PRESCRIPTIONS_LABEL"],
                "bind": "legend"
              }
            },
            "encoding": {
              "fill": {
                "field": "ANY_PRESCRIPTIONS_LABEL",
                "title": "Opioid Prescriptions Filter",
                "type": "ordinal",
                "legend": {
                  "orient": "left",
                  "titlePadding": 10,
                  "titleColor": "black",
                  "values": [
                    "True",
                    "False"
                  ],
                  "symbolSize": 0,
                  "offset": -40
                }
              },
              "opacity": {
                "condition": {"selection": "home_state_selection", "value": 1},
                "value": 0.75
              }
            }
          }
      ]
    },
    {
      "vconcat": [
        {
          "layer": [
            {
              "width": 550,
              "height": 600,
              "data": {
                "name": "counties",
                "url": "assets/pages/vis1-geomap-of-opioid-deaths/indiana.topojson",
                "format": {"type": "topojson", "feature": "counties"}
              },
              "projection": {"type": "mercator"},
              "mark": {"type": "geoshape", "fill": "white", "stroke": "darkgray"}
            },
            {
              "width": 550,
              "height": 600,
              "transform": [
                {"filter": {"selection": "period"}},
                {"filter": {"selection": "data_variable_selection"}},
                {"filter": {"selection": "sex_selection"}},
                {"filter": {"selection": "drug_type_seleciton"}},
                {"filter": {"selection": "home_state_selection"}},
                {"filter": {"selection": "1_year_seleciton"}}
              ],
              "projection": {"type": "mercator"},
              "mark": {"type": "point"},
              "encoding": {
                "longitude": {"type": "quantitative", "field": "LONGITUDE"},
                "latitude": {"type": "quantitative", "field": "LATITUDE"},
                "shape": {
                  "type": "nominal",
                  "field": "HOME_STATE$$shape",
                  "scale": null
                },
                "color": {
                  "type": "nominal",
                  "field": "VALUE",
                  "title": "Legend",
                  "scale": {
                    "domain": [
                      "Male",
                      "Female",
                      "Prescription",
                      "Illicit",
                      "True",
                      "False",
                      "Neither",
                      "0 - 9",
                      "10 - 19",
                      "20 - 29",
                      "30 - 39",
                      "40 - 49",
                      "50 - 59",
                      "60 - 69",
                      "70 >"
                    ],
                    "range": [
                      "#586CBB",
                      "#DA5E8C",
                      "#900DA4",
                      "#26C6DA",
                      "#2962FF",
                      "#FFC400",
                      "#9e9e9e",
                      "#F0F921",
                      "#FCCE25",
                      "#F1844B",
                      "#E16462",
                      "#B12A90",
                      "#900DA4",
                      "#42049E",
                      "#0D0887"
                    ]
                  },
                  "legend": {"orient": "right", "titlePadding": 10}
                },
                "size": {"value": 100}
              }
            }
          ]
        },
        {
          
          "width": 703,
          "height": 150,
          "view": {"strokeOpacity": 1},
          "layer": [
            {
              "transform": [
                {"filter": "datum.DATA_VARIABLE == 'AGE'"},
                {"filter": {"selection": "data_variable_selection"}},
                {"filter": {"selection": "sex_selection"}},
                {"filter": {"selection": "drug_type_seleciton"}},
                {"filter": {"selection": "home_state_selection"}},
                {"filter": {"selection": "1_year_seleciton"}}
              ],
              "mark": {"type": "line"},
              "selection": {
                "period": {
                  "type": "interval",
                  "encodings": ["x"],
                  "on": "[mousedown, window:mouseup] > window:mousemove{150, 300}"
                }
              },
              "encoding": {
                "x": {"type": "temporal", "field": "PERIOD", "title": "Period"},
                "y": {
                  "aggregate": "count",
                  "type": "quantitative",
                  "field": "N_OPIOID_PRESCRIPTIONS",
                  "title": "# Deaths by Quarter"
                },
                "color": {"value": "#6EA7EF"}
              }
            }
          ]
        }
      ]
    }
  ]
}