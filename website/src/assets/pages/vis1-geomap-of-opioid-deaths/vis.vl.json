{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "name": "Accidental drug overdose deaths in Marion County by place of injury 2010-2018",
  "background": "#fafafa",
  "config": {"view": {"stroke": "transparent"}},
  "padding": {"left": 10, "right": 10, "bottom": 10, "top": 10},
  "autosize": {"type": "pad", "resize": true},
  "data": {
    "url": "assets/generated/vis-geomap-opioid-deaths.csv",
    "format": {
      "type": "csv",
      "parse": {
        "N_OPIOID_PRESCRIPTIONS": "number",
        "LATITUDE": "number",
        "LONGITUDE": "number",
        "PERIOD": "date"
      }
    }
  },
  "transform": [
    {
      "lookup": "DATA_VARIABLE",
      "from": {
        "key": "DATA_VARIABLE",
        "fields": ["LEGEND_ORDER", "LABEL"],
        "data": {"url": "assets/pages/vis1-geomap-of-opioid-deaths/vis-data-variables.csv"}
      }
    },
    {
      "lookup": "VALUE",
      "from": {
        "key": "VALUE",
        "fields": ["COLOR"],
        "data": {"values": [{"VALUE":"Male","COLOR":"#586CBB"},{"VALUE":"Female","COLOR":"#DA5E8C"},{"VALUE":"Prescription","COLOR":"#900DA4"},{"VALUE":"Illicit","COLOR":"#26C6DA"},{"VALUE":"True","COLOR":"#2962FF"},{"VALUE":"False","COLOR":"#FFC400"},{"VALUE":"Neither","COLOR":"#9e9e9e"},{"VALUE":"0 - 9","COLOR":"#F0F921"},{"VALUE":"10 - 19","COLOR":"#FCCE25"},{"VALUE":"20 - 29","COLOR":"#F1844B"},{"VALUE":"30 - 39","COLOR":"#E16462"},{"VALUE":"40 - 49","COLOR":"#B12A90"},{"VALUE":"50 - 59","COLOR":"#900DA4"},{"VALUE":"60 - 69","COLOR":"#42049E"},{"VALUE":"70 >","COLOR":"#0D0887"}]}
      }
    },
    {
      "calculate": "datum.SEX === 'M' ? 'Male' : 'Female'",
      "as": "SEX_LABEL"
    },
    {
      "calculate": "datum.HOME_STATE$$shape === 'circle' ? 'Indiana' : 'Not Indiana'",
      "as": "HOME_STATE_LABEL"
    },
    {
      "calculate": "datum.N_OPIOID_PRESCRIPTIONS > 0 ? 'True' : 'False'",
      "as": "ANY_PRESCRIPTIONS_LABEL"
    }
  ],
  "hconcat": [
    {
      "spacing": 0,
      "resolve": {"scale": {"fill": "independent"}},
      "vconcat": [
        {
          "mark": {"type": "text", "fontSize": 0},
          "data": {"values": []},
          "selection": {
            "data_variable_selection": {
              "type": "single",
              "fields": ["LABEL"],
              "bind": {"legend": "click"},
              "init": {"LABEL": "Age"},
              "empty": "none"
            }
          },
          "encoding": {
            "fill": {
              "field": "LABEL",
              "title": "Select Data Variable",
              "type": "ordinal",
              "legend": {
                "orient": "none",
                "legendX": -250,
                "legendY": 0,
                "titlePadding": 10,
                "titleColor": "#9e9e9e",
                "values": [
                  "Gender",
                  "Age",
                  "Opioid Prescriptions within last year before death",
                  "Any Opioid Prescriptions before death",
                  "Prescription vs. Illicit Drugs"
                ],
                "symbolSize": 0
              }
            },
            "opacity": {
              "condition": {"selection": "data_variable_selection", "value": 1},
              "value": 0.75
            }
          }
        },
        {
          "mark": {"type": "text", "fontSize": 0},
          "data": {"values": []},
          "encoding": {
            "fill": {
              "field": "LABEL",
              "title": "Filter by",
              "type": "ordinal",
              "legend": {
                "orient": "none",
                "legendX": -250,
                "legendY": 20,
                "titlePadding": 10,
                "titleColor": "#9e9e9e",
                "values": [],
                "symbolSize": 0
              }
            }
          }
        },
        {
          "mark": {"type": "text", "fontSize": 0},
          "data": {"values": []},
          "selection": {
            "sex_selection": {
              "type": "single",
              "fields": ["SEX_LABEL"],
              "bind": {"legend": "click"}
            }
          },
          "encoding": {
            "fill": {
              "field": "SEX_LABEL",
              "title": "Sex",
              "type": "ordinal",
              "legend": {
                "orient": "none",
                "legendX": -240,
                "legendY": 10,
                "titlePadding": 10,
                "titleColor": "#9e9e9e",
                "values": [
                  "Male",
                  "Female"
                ],
                "symbolSize": 0
              }
            },
            "opacity": {
              "condition": {"selection": "sex_selection", "value": 1},
              "value": 0.75
            }
          }
        },
        {
          "mark": {"type": "text", "fontSize": 0},
          "data": {"values": []},
          "selection": {
            "drug_type_seleciton": {
              "type": "single",
              "fields": ["ILLICIT_V_PRESCRIPTION"],
              "bind": {"legend": "click"}
            }
          },
          "encoding": {
            "fill": {
              "field": "ILLICIT_V_PRESCRIPTION",
              "title": "Drug Type",
              "type": "ordinal",
              "legend": {
                "orient": "none",
                "legendX": -240,
                "legendY": 10,
                "titlePadding": 10,
                "titleColor": "#9e9e9e",
                "values": [
                  "Illicit",
                  "Prescription",
                  "Neither"
                ],
                "symbolSize": 0
              }
            },
            "opacity": {
              "condition": {"selection": "sex_selection", "value": 1},
              "value": 0.75
            }
          }
        },
        {
          "mark": {"type": "text", "fontSize": 0},
          "data": {"values": []},
          "selection": {
            "home_state_selection": {
              "type": "single",
              "fields": ["HOME_STATE_LABEL"],
              "bind": {"legend": "click"}
            }
          },
          "encoding": {
            "fill": {
              "field": "HOME_STATE_LABEL",
              "title": "Home State",
              "type": "ordinal",
              "legend": {
                "orient": "none",
                "legendX": -240,
                "legendY": 10,
                "titlePadding": 10,
                "titleColor": "#9e9e9e",
                "values": [
                  "Indiana",
                  "Not Indiana"
                ],
                "symbolSize": 0
              }
            },
            "opacity": {
              "condition": {"selection": "home_state_selection", "value": 1},
              "value": 0.75
            }
          }
        },
        {
          "mark": {"type": "text", "fontSize": 0},
          "data": {"values": []},
          "selection": {
            "1_year_selection": {
              "type": "single",
              "fields": ["OPIOID_PRESCRIPTIONS_1YEAR"],
              "bind": {"legend": "click"}
            }
          },
          "encoding": {
            "fill": {
              "field": "OPIOID_PRESCRIPTIONS_1YEAR",
              "title": "Opioid Prescription 1 Year",
              "type": "ordinal",
              "legend": {
                "orient": "none",
                "legendX": -240,
                "legendY": 10,
                "titlePadding": 10,
                "titleColor": "#9e9e9e",
                "values": [
                  "True",
                  "False"
                ],
                "symbolSize": 0
              }
            },
            "opacity": {
              "condition": {"selection": "1_year_selection", "value": 1},
              "value": 0.75
            }
          }
        },
        {
          "mark": {"type": "text", "fontSize": 0},
          "data": {"values": []},
          "selection": {
            "opioid_rx_selection": {
              "type": "single",
              "fields": ["ANY_PRESCRIPTIONS_LABEL"],
              "bind": {"legend": "click"}
            }
          },
          "encoding": {
            "fill": {
              "field": "ANY_PRESCRIPTIONS_LABEL",
              "title": "Opioid Prescriptions",
              "type": "ordinal",
              "legend": {
                "orient": "none",
                "legendX": -240,
                "legendY": 10,
                "titlePadding": 10,
                "titleColor": "#9e9e9e",
                "values": [
                  "True",
                  "False"
                ],
                "symbolSize": 0
              }
            },
            "opacity": {
              "condition": {"selection": "opioid_rx_selection", "value": 1},
              "value": 0.75
            }
          }
        }
      ]
    },
    {
      "vconcat": [
        {
          "layer": [
            {
              "width": 550,
              "height": 600,
              "data": {
                "name": "counties",
                "url": "assets/pages/vis1-geomap-of-opioid-deaths/indiana.topojson",
                "format": {"type": "topojson", "feature": "counties"}
              },
              "projection": {"type": "mercator"},
              "mark": {"type": "geoshape", "fill": "white", "stroke": "darkgray"}
            },
            {
              "width": 550,
              "height": 600,
              "transform": [
                {"filter": {"selection": "period"}},
                {"filter": {"selection": "data_variable_selection"}},
                {"filter": {"and": [
                  {"selection": "sex_selection"},
                  {"selection": "drug_type_seleciton"},
                  {"selection": "home_state_selection"},
                  {"selection": "1_year_selection"},
                  {"selection": "opioid_rx_selection"}
                ]}}
              ],
              "projection": {"type": "mercator"},
              "mark": {"type": "point"},
              "encoding": {
                "longitude": {"type": "quantitative", "field": "LONGITUDE"},
                "latitude": {"type": "quantitative", "field": "LATITUDE"},
                "shape": {
                  "type": "nominal",
                  "field": "HOME_STATE_LABEL",
                  "title": "Home State",
                  "scale": {"range": {"field": "HOME_STATE$$shape"}},
                  "legend": {"orient": "right", "titlePadding": 10, "titleColor": "#9e9e9e"}
                },
                "color": {
                  "type": "nominal",
                  "field": "VALUE",
                  "title": "Color",
                  "scale": {"range": {"field": "COLOR"}},
                  "legend": {"orient": "right", "titlePadding": 10, "titleColor": "#9e9e9e"}
                },
                "size": {"value": 100}
              }
            }
          ]
        },
        {
          "width": 703,
          "height": 150,
          "view": {"strokeOpacity": 1},
          "layer": [
            {
              "transform": [
                {"filter": {"field": "DATA_VARIABLE", "equal": "AGE"}},
                {"filter": {"and": [
                  {"selection": "sex_selection"},
                  {"selection": "drug_type_seleciton"},
                  {"selection": "home_state_selection"},
                  {"selection": "1_year_selection"},
                  {"selection": "opioid_rx_selection"}
                ]}}
              ],
              "mark": {"type": "line"},
              "selection": {
                "period": {
                  "type": "interval",
                  "encodings": ["x"],
                  "on": "[mousedown, window:mouseup] > window:mousemove{150, 300}",
                  "clear": "dblclick"
                }
              },
              "encoding": {
                "x": {"type": "temporal", "field": "PERIOD", "title": "Period"},
                "y": {
                  "aggregate": "count",
                  "type": "quantitative",
                  "field": "N_OPIOID_PRESCRIPTIONS",
                  "title": "# Deaths by Quarter"
                },
                "color": {"value": "#6EA7EF"}
              }
            }
          ]
        }
      ]
    }
  ]
}
