{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {"url": "http://localhost:33284/assets/generated/visualization6/data1.csv",
    "format": {
      "type":"csv",
      "parse": {
        "PERIOD":"date",
        "DOD":"date",
        "COUNT": "number",
        "RANK": "number",
        "Encounter_Type": "string"
      }
    }
  },
  "transform": [
    {
      "calculate": "round(12 * (datum.DOD - datum.PERIOD) / 3.154e+10)",
      "as": "TIME_BEFORE_DEATH"
    },
    {
      "calculate": "toNumber(datum.TIME_BEFORE_DEATH) / 12",
      "as": "MONTHS_BEFORE_DEATH"
    },
    {
      "filter": "datum.TIME_BEFORE_DEATH >= 0"
    }
  ],
  "spacing": {"row": -20},
  "facet": {
    "row": {
      "field": "RANK",
      "type": "nominal",
      "bin": false,
      "header": null
    }
  },
  "spec": {
    "title": " ",
    "width": 700,
    "height": 20,
    "view": {"stroke": null},
    "mark": { "type": "area", "line": {"size": 0.5} },
    "encoding": {
      "x": {
        "field": "TIME_BEFORE_DEATH",
        "type": "quantitative",
        "title": "Years Before Death",
        "axis": {
          "orient": "top",
          "labelExpr": "datum.value / 12",
          "values": [
            0, 12, 24, 36, 48, 60, 72, 84, 96, 108, 120, 132, 144, 156, 168, 180
          ]
        },
        "scale": {
          "domainMin": 0,
          "range": ["width", 0]
        }
      },
      "y": {
        "field": "COUNT",
        "type": "quantitative",
        "scale": {"zero": true, "type": "symlog"},
        "stack": "zero",
        "axis": {
          "title": null,
          "labels": false,
          "ticks": false,
          "grid": false
        }
      },
      "color": {
        "field": "Encounter_Type",
        "type": "nominal",
        "scale": {
          "domain": [
            "All Types",
            "Health Encounters",
            "Opiod Prescriptions",
            "Incarcerations",
            "Overdoses"
          ],
          "range": [
            "#e5dcc5ff",
            "#9fc893ff",
            "#fbdb39ff",
            "#1a659eff",
            "#bc1041ff"
          ]
        }
      },
      "tooltip": {
        "field": "RANK",
        "type": "nominal"
      }
    }
  },
  "config": {
    "axis": {
      "grid": true,
      "domain": false
    },
    "view": {
      "continuousHeight": 200
    }
  }
}